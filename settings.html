<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>设置 - 课堂助手</title>
    <link rel="stylesheet" href="css/styles.css" />
    <link rel="stylesheet" href="css/sidebar.css" />
    <!-- 添加页脚样式 -->
    <link rel="stylesheet" href="css/footer.css" />
    <!-- 添加滚动动画样式 -->
    <link rel="stylesheet" href="css/scrollAnimation.css" />
    <!-- 添加主题样式 -->
    <link rel="stylesheet" href="css/themes/themes.css" />
    <!-- 使用图标库 -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <!-- 添加 Remix Icon 库，用于侧边栏图标 -->
    <link
      href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css"
      rel="stylesheet"
    />
    <style>
      /* 设置页面特定样式 */
      .settings-container {
        display: flex;
        flex-direction: column;
        gap: 2rem;
      }

      .settings-card {
        background-color: var(--background-color);
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
        padding: 1.5rem;
      }

      .settings-section {
        margin-bottom: 2rem;
      }

      .settings-section:last-child {
        margin-bottom: 0;
      }

      .settings-header {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        margin-bottom: 1.5rem;
        padding-bottom: 0.75rem;
        border-bottom: 1px solid var(--border-color);
      }

      .settings-header i {
        font-size: 1.5rem;
        color: var(--primary-color);
      }

      .settings-title {
        font-size: 1.25rem;
        font-weight: 600;
      }

      .settings-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 0;
        border-bottom: 1px solid var(--border-color);
      }

      .settings-row:last-child {
        border-bottom: none;
      }

      .settings-label {
        display: flex;
        flex-direction: column;
      }

      .settings-name {
        font-weight: 500;
        margin-bottom: 0.25rem;
      }

      .settings-description {
        font-size: 0.9rem;
        color: var(--text-secondary);
      }

      /* 主题切换开关样式 */
      .theme-switch {
        position: relative;
        display: inline-block;
        width: 60px;
        height: 30px;
      }

      .theme-switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }

      .theme-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: var(--background-secondary);
        transition: 0.4s;
        border-radius: 30px;
      }

      .theme-slider:before {
        position: absolute;
        content: "";
        height: 22px;
        width: 22px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: 0.4s;
        border-radius: 50%;
      }

      input:checked + .theme-slider {
        background-color: var(--primary-color);
      }

      input:checked + .theme-slider:before {
        transform: translateX(30px);
      }

      /* 语言选择器样式 */
      .language-selector {
        display: flex;
        gap: 1rem;
      }

      .language-option {
        display: flex;
        align-items: center;
        padding: 0.5rem 1rem;
        border-radius: var(--border-radius);
        cursor: pointer;
        border: 1px solid var(--border-color);
        transition: all 0.3s;
      }

      .language-option.active {
        background-color: var(--primary-light);
        border-color: var(--primary-color);
        color: var(--primary-color);
      }

      .language-option img {
        width: 20px;
        height: 20px;
        margin-right: 0.5rem;
      }

      /* 响应式调整 */
      @media (max-width: 768px) {
        .settings-row {
          flex-direction: column;
          align-items: flex-start;
          gap: 1rem;
        }

        .language-selector {
          width: 100%;
          justify-content: space-between;
        }

        .language-option {
          flex: 1;
          justify-content: center;
        }
      }

      /* 清除数据部分样式 */
      .data-management {
        margin-top: 2rem;
        padding-top: 2rem;
        /* 移除顶部边框，避免与上一个设置行的底部边框重叠 */
        /* border-top: 1px solid var(--border-color); */
      }

      .data-action-buttons {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        margin-top: 1rem;
      }

      .btn-warning {
        background-color: var(--warning-color);
        color: white;
      }

      .btn-warning:hover {
        background-color: #e69500;
      }

      .btn-danger {
        background-color: var(--danger-color);
        color: white;
      }

      .btn-danger:hover {
        background-color: #c53030;
      }

      /* 添加模态框样式 */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        align-items: center;
        justify-content: center;
        z-index: 1000;
      }

      .modal-content {
        background-color: var(--background-color);
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
        padding: 2rem;
        max-width: 500px;
        width: 90%;
        position: relative;
      }

      .modal-close {
        position: absolute;
        right: 1.5rem;
        top: 1rem;
        font-size: 1.5rem;
        cursor: pointer;
        color: var(--text-secondary);
      }

      .modal-footer {
        display: flex;
        justify-content: flex-end;
        gap: 1rem;
        margin-top: 1.5rem;
      }

      /* 小球主题切换器样式 */
      .theme-switcher {
        display: flex;
        gap: 1.5rem;
        flex-wrap: wrap;
        justify-content: center;
        max-width: 100%;
        margin-top: 1rem;
      }

      .theme-ball {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        cursor: pointer;
        position: relative;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        transition: transform 0.3s, box-shadow 0.3s;
      }

      .theme-ball:hover {
        transform: scale(1.1) translateY(-5px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
      }

      /* 增强的选中状态效果 */
      .theme-ball.active {
        transform: scale(1.1);
        animation: pulse 2s infinite;
        box-shadow: 0 0 0 4px var(--gradient-start),
          0 0 20px 8px rgba(var(--gradient-start-rgb), 0.3),
          0 10px 25px rgba(0, 0, 0, 0.3);
      }

      @keyframes pulse {
        0% {
          box-shadow: 0 0 0 4px var(--gradient-start),
            0 0 20px 8px rgba(var(--gradient-start-rgb), 0.3),
            0 10px 25px rgba(0, 0, 0, 0.3);
        }
        50% {
          box-shadow: 0 0 0 6px var(--gradient-start),
            0 0 30px 12px rgba(var(--gradient-start-rgb), 0.4),
            0 15px 35px rgba(0, 0, 0, 0.4);
        }
        100% {
          box-shadow: 0 0 0 4px var(--gradient-start),
            0 0 20px 8px rgba(var(--gradient-start-rgb), 0.3),
            0 10px 25px rgba(0, 0, 0, 0.3);
        }
      }

      .tooltip {
        position: absolute;
        bottom: -45px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 6px 10px;
        border-radius: 6px;
        font-size: 0.8rem;
        opacity: 0;
        pointer-events: none;
        white-space: nowrap;
        transition: opacity 0.2s;
        z-index: 100;
      }

      .theme-ball:hover .tooltip {
        opacity: 1;
      }

      .current-theme {
        margin-top: 2rem;
        padding: 0.75rem 1.5rem;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 50px;
        font-size: 1rem;
        font-weight: bold;
        border: 2px solid var(--gradient-start);
        text-align: center;
      }

      /* 主题小球颜色 */
      .classic-blue-pink-ball {
        background: linear-gradient(135deg, #91defe, #f9bccc);
      }

      .mint-purple-ball {
        background: linear-gradient(135deg, #a0e8e0, #d4bbfc);
      }

      .peach-coral-ball {
        background: linear-gradient(135deg, #ffd7e8, #ffb7c5);
      }

      .green-blue-ball {
        background: linear-gradient(135deg, #d2e8c8, #b5d8ff);
      }

      .lavender-cream-ball {
        background: linear-gradient(135deg, #e6c6ff, #fff2d7);
      }

      .blue-violet-ball {
        background: linear-gradient(135deg, #b5d8ff, #d4bbfc);
      }

      .coral-mint-ball {
        background: linear-gradient(135deg, #ffb7c5, #a0e8e0);
      }

      .sunset-ball {
        background: linear-gradient(135deg, #f9bccc, #fff2d7);
      }

      .dark-ball {
        background: linear-gradient(135deg, #4a7b9b, #7a4a6b);
      }

      /* 响应式调整 */
      @media (max-width: 768px) {
        .theme-switcher {
          gap: 1rem;
        }

        .theme-ball {
          width: 50px;
          height: 50px;
        }
      }

      @media (max-width: 576px) {
        .theme-switcher {
          gap: 0.8rem;
        }

        .theme-ball {
          width: 45px;
          height: 45px;
        }
      }
    </style>
  </head>
  <body>
    <!-- 侧边栏导航 -->
    <aside class="sidebar">
      <!-- 按钮组 -->
      <div class="sidebar-btn">
        <div class="sidebar-btn-item"></div>
        <div class="sidebar-btn-item"></div>
        <div class="sidebar-btn-item"></div>
      </div>

      <!-- 用户资料 -->
      <div class="sidebar-profile">
        <div class="sidebar-profile-img">
          <img
            src="https://randomuser.me/api/portraits/men/32.jpg"
            alt="用户头像"
          />
        </div>
        <div class="sidebar-profile-text">
          <p>欢迎使用</p>
          <h2>课堂助手</h2>
        </div>
      </div>

      <div class="sidebar-line"></div>

      <!-- 主菜单 -->
      <div class="sidebar-title">
        <p>主菜单</p>
      </div>

      <div class="sidebar-menu">
        <div class="sidebar-item" data-href="index.html">
          <div class="sidebar-light"></div>
          <div class="sidebar-icon-left"><i class="ri-home-line"></i></div>
          <div class="sidebar-text">首页</div>
          <div class="sidebar-icon-right">
            <i class="ri-dashboard-line"></i>
          </div>
        </div>

        <div class="sidebar-item" data-href="schedule.html">
          <div class="sidebar-light"></div>
          <div class="sidebar-icon-left"><i class="ri-calendar-line"></i></div>
          <div class="sidebar-text">课表</div>
          <div class="sidebar-icon-right">
            <i class="ri-arrow-right-s-line"></i>
          </div>
        </div>

        <div class="sidebar-item" data-href="grades.html">
          <div class="sidebar-light"></div>
          <div class="sidebar-icon-left"><i class="ri-bar-chart-line"></i></div>
          <div class="sidebar-text">成绩管理</div>
          <div class="sidebar-icon-right">
            <i class="ri-arrow-right-s-line"></i>
          </div>
        </div>

        <div class="sidebar-item" data-href="countdown.html">
          <div class="sidebar-light"></div>
          <div class="sidebar-icon-left"><i class="ri-time-line"></i></div>
          <div class="sidebar-text">考试倒计时</div>
          <div class="sidebar-icon-right">
            <i class="ri-arrow-right-s-line"></i>
          </div>
        </div>
      </div>

      <div class="sidebar-line"></div>

      <!-- 个人中心 -->
      <div class="sidebar-title">
        <p>个人中心</p>
      </div>

      <div class="sidebar-menu">
        <div class="sidebar-item" data-href="profile.html">
          <div class="sidebar-light"></div>
          <div class="sidebar-icon-left"><i class="ri-user-line"></i></div>
          <div class="sidebar-text">个人资料</div>
          <div class="sidebar-icon-right">
            <i class="ri-arrow-right-s-line"></i>
          </div>
        </div>

        <div class="sidebar-item active" data-href="settings.html">
          <div class="sidebar-light"></div>
          <div class="sidebar-icon-left">
            <i class="ri-settings-3-line"></i>
          </div>
          <div class="sidebar-text">设置</div>
          <div class="sidebar-icon-right">
            <i class="ri-settings-3-line"></i>
          </div>
        </div>
      </div>
    </aside>

    <!-- 移动端菜单切换按钮 -->
    <div class="sidebar-toggle">
      <i class="ri-menu-line"></i>
    </div>

    <!-- 移动端遮罩层 -->
    <div class="sidebar-overlay"></div>

    <!-- 主内容区 -->
    <div class="container py-4 sidebar-active">
      <h1 class="mb-4 animate-on-scroll fade-up">设置</h1>

      <div class="settings-container">
        <!-- 显示设置 -->
        <div class="settings-card animate-on-scroll fade-up">
          <div class="settings-section">
            <div class="settings-header">
              <i class="fas fa-palette"></i>
              <h2 class="settings-title">显示设置</h2>
            </div>

            <div class="settings-row">
              <div class="settings-label">
                <div class="settings-name">主题颜色</div>
                <div class="settings-description">选择您喜欢的配色主题</div>
              </div>
              <div class="settings-content">
                <div class="theme-switcher" id="theme-switcher">
                  <!-- 经典蓝粉渐变 -->
                  <div
                    class="theme-ball classic-blue-pink-ball"
                    data-theme="classic-blue-pink"
                  >
                    <div class="tooltip">
                      经典蓝粉<br />
                      渐变: #91defe → #f9bccc
                    </div>
                  </div>

                  <!-- 薄荷紫渐变 -->
                  <div
                    class="theme-ball mint-purple-ball"
                    data-theme="mint-purple"
                  >
                    <div class="tooltip">
                      薄荷紫<br />
                      渐变: #a0e8e0 → #d4bbfc
                    </div>
                  </div>

                  <!-- 蜜桃珊瑚渐变 -->
                  <div
                    class="theme-ball peach-coral-ball"
                    data-theme="peach-coral"
                  >
                    <div class="tooltip">
                      蜜桃珊瑚<br />
                      渐变: #ffd7e8 → #ffb7c5
                    </div>
                  </div>

                  <!-- 绿蓝渐变 -->
                  <div
                    class="theme-ball green-blue-ball"
                    data-theme="green-blue"
                  >
                    <div class="tooltip">
                      绿蓝渐变<br />
                      渐变: #d2e8c8 → #b5d8ff
                    </div>
                  </div>

                  <!-- 薰衣草奶油渐变 -->
                  <div
                    class="theme-ball lavender-cream-ball"
                    data-theme="lavender-cream"
                  >
                    <div class="tooltip">
                      薰衣草奶油<br />
                      渐变: #e6c6ff → #fff2d7
                    </div>
                  </div>

                  <!-- 蓝紫渐变 -->
                  <div
                    class="theme-ball blue-violet-ball"
                    data-theme="blue-violet"
                  >
                    <div class="tooltip">
                      蓝紫渐变<br />
                      渐变: #b5d8ff → #d4bbfc
                    </div>
                  </div>

                  <!-- 珊瑚薄荷渐变 -->
                  <div
                    class="theme-ball coral-mint-ball"
                    data-theme="coral-mint"
                  >
                    <div class="tooltip">
                      珊瑚薄荷<br />
                      渐变: #ffb7c5 → #a0e8e0
                    </div>
                  </div>

                  <!-- 夕阳渐变 -->
                  <div class="theme-ball sunset-ball" data-theme="sunset">
                    <div class="tooltip">
                      夕阳渐变<br />
                      渐变: #f9bccc → #fff2d7
                    </div>
                  </div>

                  <!-- 深色模式 -->
                  <div class="theme-ball dark-ball" data-theme="dark">
                    <div class="tooltip">
                      深色模式<br />
                      渐变: #4a7b9b → #7a4a6b
                    </div>
                  </div>
                </div>
                <div class="current-theme" id="current-theme">
                  当前主题: 经典蓝粉
                </div>
              </div>
            </div>

            <div class="settings-row">
              <div class="settings-label">
                <div class="settings-name">字体大小</div>
                <div class="settings-description">调整界面文字大小</div>
              </div>
              <div class="font-size-controls">
                <button class="btn btn-outline" id="decrease-font">A-</button>
                <button class="btn" id="reset-font">重置</button>
                <button class="btn btn-outline" id="increase-font">A+</button>
              </div>
            </div>
          </div>
        </div>

        <!-- 语言设置 -->
        <div class="settings-card animate-on-scroll fade-up delay-100">
          <div class="settings-section">
            <div class="settings-header">
              <i class="fas fa-language"></i>
              <h2 class="settings-title">语言设置</h2>
            </div>

            <div class="settings-row">
              <div class="settings-label">
                <div class="settings-name">界面语言</div>
                <div class="settings-description">选择您偏好的语言</div>
              </div>
              <div class="language-selector">
                <div class="language-option active" data-lang="zh">
                  <img
                    src="https://cdn.jsdelivr.net/npm/flag-icon-css@3.5.0/flags/4x3/cn.svg"
                    alt="中文"
                  />
                  中文
                </div>
                <div class="language-option" data-lang="en">
                  <img
                    src="https://cdn.jsdelivr.net/npm/flag-icon-css@3.5.0/flags/4x3/us.svg"
                    alt="English"
                  />
                  English
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 通知设置 -->
        <div class="settings-card animate-on-scroll fade-up delay-200">
          <div class="settings-section">
            <div class="settings-header">
              <i class="fas fa-bell"></i>
              <h2 class="settings-title">通知设置</h2>
            </div>

            <div class="settings-row">
              <div class="settings-label">
                <div class="settings-name">课程提醒</div>
                <div class="settings-description">课程开始前提醒</div>
              </div>
              <label class="theme-switch">
                <input type="checkbox" id="course-notification" checked />
                <span class="theme-slider"></span>
              </label>
            </div>

            <div class="settings-row">
              <div class="settings-label">
                <div class="settings-name">考试提醒</div>
                <div class="settings-description">考试日期提醒</div>
              </div>
              <label class="theme-switch">
                <input type="checkbox" id="exam-notification" checked />
                <span class="theme-slider"></span>
              </label>
            </div>

            <div class="settings-row">
              <div class="settings-label">
                <div class="settings-name">提前提醒时间</div>
                <div class="settings-description">选择提醒时间</div>
              </div>
              <select class="form-control" id="reminder-time">
                <option value="15">15分钟前</option>
                <option value="30" selected>30分钟前</option>
                <option value="60">1小时前</option>
                <option value="120">2小时前</option>
                <option value="1440">1天前</option>
              </select>
            </div>
          </div>
        </div>

        <!-- 数据管理 -->
        <div class="settings-card animate-on-scroll fade-up delay-300">
          <div class="settings-section">
            <div class="settings-header">
              <i class="fas fa-database"></i>
              <h2 class="settings-title">数据管理</h2>
            </div>

            <div class="settings-row">
              <div class="settings-label">
                <div class="settings-name">备份数据</div>
                <div class="settings-description">导出所有课表和考试数据</div>
              </div>
              <button class="btn btn-outline" id="backup-data">
                <i class="fas fa-download"></i> 备份
              </button>
            </div>

            <div class="settings-row">
              <div class="settings-label">
                <div class="settings-name">恢复数据</div>
                <div class="settings-description">从备份文件导入数据</div>
              </div>
              <div>
                <input
                  type="file"
                  id="restore-input"
                  style="display: none"
                  accept=".json"
                />
                <label for="restore-input" class="btn btn-outline">
                  <i class="fas fa-upload"></i> 恢复
                </label>
              </div>
            </div>

            <div class="data-management">
              <div class="settings-name mb-2">清除数据</div>
              <div class="settings-description mb-3">
                清除应用中存储的部分或全部数据
              </div>
              <div class="data-action-buttons">
                <button class="btn btn-warning" id="clear-schedule-data">
                  <i class="fas fa-calendar-times"></i> 清除课表数据
                </button>
                <button class="btn btn-warning" id="clear-exams-data">
                  <i class="fas fa-calendar-minus"></i> 清除考试数据
                </button>
                <button class="btn btn-danger" id="clear-all-data">
                  <i class="fas fa-trash-alt"></i> 清除全部数据
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- 关于 -->
        <div class="settings-card animate-on-scroll fade-up delay-400">
          <div class="settings-section">
            <div class="settings-header">
              <i class="fas fa-info-circle"></i>
              <h2 class="settings-title">关于</h2>
            </div>

            <div class="settings-row">
              <div class="settings-label">
                <div class="settings-name">版本</div>
                <div class="settings-description">课堂助手 1.0.0</div>
              </div>
              <button class="btn btn-outline" id="check-updates">
                检查更新
              </button>
            </div>

            <div class="settings-row">
              <div class="settings-label">
                <div class="settings-name">开发者</div>
                <div class="settings-description">课堂助手开发团队</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 确认弹窗 -->
    <div class="modal" id="confirm-modal">
      <div class="modal-content">
        <div class="modal-close" id="close-confirm-modal">×</div>
        <h2 class="mb-3" id="confirm-title">确认操作</h2>
        <p id="confirm-message">您确定要执行此操作吗？此操作无法撤销。</p>
        <div class="modal-footer">
          <button class="btn btn-outline" id="cancel-action">取消</button>
          <button class="btn btn-danger" id="confirm-action">确认</button>
        </div>
      </div>
    </div>

    <!-- 页脚 - 简化为只保留容器 -->
    <footer class="footer"></footer>

    <script src="js/main.js"></script>
    <script src="js/sidebar.js"></script>
    <!-- 添加页脚脚本 -->
    <script src="js/footer.js"></script>
    <!-- 添加滚动动画脚本 -->
    <script src="js/scrollAnimation.js"></script>
    <!-- 添加主题管理脚本 -->
    <script src="js/themes.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // 初始化滚动动画
        initScrollAnimation(".animate-on-scroll", {
          threshold: 0.1,
          once: true,
        });

        // 字体大小控制
        const decreaseFontBtn = document.getElementById("decrease-font");
        const resetFontBtn = document.getElementById("reset-font");
        const increaseFontBtn = document.getElementById("increase-font");

        // 获取当前字体大小缩放比例
        let fontScale = parseFloat(localStorage.getItem("fontScale") || "1");

        // 应用字体大小
        applyFontSize(fontScale);

        decreaseFontBtn.addEventListener("click", function () {
          if (fontScale > 0.8) {
            fontScale -= 0.1;
            applyFontSize(fontScale);
          }
        });

        resetFontBtn.addEventListener("click", function () {
          fontScale = 1;
          applyFontSize(fontScale);
        });

        increaseFontBtn.addEventListener("click", function () {
          if (fontScale < 1.5) {
            fontScale += 0.1;
            applyFontSize(fontScale);
          }
        });

        // 应用字体大小
        function applyFontSize(scale) {
          document.documentElement.style.fontSize = `${scale}rem`;
          localStorage.setItem("fontScale", scale.toString());
        }

        // 语言切换
        const languageOptions = document.querySelectorAll(".language-option");

        languageOptions.forEach((option) => {
          option.addEventListener("click", function () {
            const language = this.getAttribute("data-lang");

            // 移除所有活动类
            languageOptions.forEach((opt) => opt.classList.remove("active"));

            // 添加活动类到当前选择
            this.classList.add("active");

            // 存储语言偏好
            localStorage.setItem("language", language);

            // 显示切换提示
            showNotification(
              `界面语言已切换为${language === "zh" ? "中文" : "English"}`,
              "success"
            );

            // 实际项目中这里会调用翻译函数
            // Translator.setLanguage(language);
          });
        });

        // 初始化确认弹窗
        const confirmModal = document.getElementById("confirm-modal");
        const closeConfirmModal = document.getElementById(
          "close-confirm-modal"
        );
        const cancelAction = document.getElementById("cancel-action");
        const confirmAction = document.getElementById("confirm-action");
        const confirmTitle = document.getElementById("confirm-title");
        const confirmMessage = document.getElementById("confirm-message");

        // 关闭确认弹窗
        function closeModal() {
          confirmModal.style.display = "none";
        }

        closeConfirmModal.addEventListener("click", closeModal);
        cancelAction.addEventListener("click", closeModal);

        // 点击外部关闭弹窗
        window.addEventListener("click", function (event) {
          if (event.target === confirmModal) {
            closeModal();
          }
        });

        // 清除数据按钮事件
        document
          .getElementById("clear-schedule-data")
          .addEventListener("click", function () {
            showConfirmModal(
              "清除课表数据",
              "您确定要清除所有课表数据吗？此操作无法撤销。",
              function () {
                // 清除课表数据
                localStorage.removeItem("courses");
                showNotification("课表数据已清除", "success");
              }
            );
          });

        document
          .getElementById("clear-exams-data")
          .addEventListener("click", function () {
            showConfirmModal(
              "清除考试数据",
              "您确定要清除所有考试数据吗？此操作无法撤销。",
              function () {
                // 清除考试数据
                localStorage.removeItem("exams");
                showNotification("考试数据已清除", "success");
              }
            );
          });

        document
          .getElementById("clear-all-data")
          .addEventListener("click", function () {
            showConfirmModal(
              "清除全部数据",
              "您确定要清除所有应用数据吗？这将删除所有课表、考试和个人设置数据。此操作无法撤销。",
              function () {
                // 保留主题和语言设置
                const theme = localStorage.getItem("theme");
                const language = localStorage.getItem("language");

                // 清除所有数据
                localStorage.clear();

                // 恢复主题和语言设置
                if (theme) localStorage.setItem("theme", theme);
                if (language) localStorage.setItem("language", language);

                showNotification("所有数据已清除", "success");
              }
            );
          });

        // 显示确认弹窗
        function showConfirmModal(title, message, callback) {
          confirmTitle.textContent = title;
          confirmMessage.textContent = message;
          confirmModal.style.display = "flex";

          // 移除之前的事件监听器
          confirmAction.replaceWith(confirmAction.cloneNode(true));

          // 添加新的确认操作
          document
            .getElementById("confirm-action")
            .addEventListener("click", function () {
              callback();
              closeModal();
            });
        }

        // 备份数据
        document
          .getElementById("backup-data")
          .addEventListener("click", function () {
            const backupData = {
              courses: localStorage.getItem("courses"),
              exams: localStorage.getItem("exams"),
              profile: localStorage.getItem("profile"),
              settings: {
                theme: localStorage.getItem("theme"),
                language: localStorage.getItem("language"),
                fontScale: localStorage.getItem("fontScale"),
                notifications: {
                  course: document.getElementById("course-notification")
                    .checked,
                  exam: document.getElementById("exam-notification").checked,
                  reminderTime: document.getElementById("reminder-time").value,
                },
              },
              backupDate: new Date().toISOString(),
            };

            const dataStr = JSON.stringify(backupData);
            const dataUri =
              "data:application/json;charset=utf-8," +
              encodeURIComponent(dataStr);

            const exportFileName =
              "classhelper-backup-" +
              new Date().toISOString().slice(0, 10) +
              ".json";

            const linkElement = document.createElement("a");
            linkElement.setAttribute("href", dataUri);
            linkElement.setAttribute("download", exportFileName);
            linkElement.click();

            showNotification("数据备份已下载", "success");
          });

        // 恢复数据
        const restoreInput = document.getElementById("restore-input");
        restoreInput.addEventListener("change", function (e) {
          const file = e.target.files[0];
          if (!file) return;

          const reader = new FileReader();
          reader.onload = function (e) {
            try {
              const backupData = JSON.parse(e.target.result);

              // 确认恢复
              showConfirmModal(
                "恢复数据",
                `您确定要从备份中恢复数据吗？这将覆盖当前的数据。\n备份日期: ${new Date(
                  backupData.backupDate
                ).toLocaleString()}`,
                function () {
                  // 恢复数据
                  if (backupData.courses)
                    localStorage.setItem("courses", backupData.courses);
                  if (backupData.exams)
                    localStorage.setItem("exams", backupData.exams);
                  if (backupData.profile)
                    localStorage.setItem("profile", backupData.profile);

                  // 恢复设置
                  if (backupData.settings) {
                    if (backupData.settings.theme) {
                      localStorage.setItem("theme", backupData.settings.theme);
                      document.body.setAttribute(
                        "data-theme",
                        backupData.settings.theme
                      );
                      themeToggle.checked =
                        backupData.settings.theme === "dark";
                    }

                    if (backupData.settings.language) {
                      localStorage.setItem(
                        "language",
                        backupData.settings.language
                      );
                      languageOptions.forEach((opt) => {
                        opt.classList.toggle(
                          "active",
                          opt.getAttribute("data-lang") ===
                            backupData.settings.language
                        );
                      });
                    }

                    if (backupData.settings.fontScale) {
                      fontScale = parseFloat(backupData.settings.fontScale);
                      applyFontSize(fontScale);
                    }

                    if (backupData.settings.notifications) {
                      document.getElementById("course-notification").checked =
                        backupData.settings.notifications.course !== false;
                      document.getElementById("exam-notification").checked =
                        backupData.settings.notifications.exam !== false;

                      if (backupData.settings.notifications.reminderTime) {
                        document.getElementById("reminder-time").value =
                          backupData.settings.notifications.reminderTime;
                      }
                    }
                  }

                  showNotification("数据已成功恢复", "success");

                  // 重置文件输入
                  restoreInput.value = "";
                }
              );
            } catch (error) {
              showNotification("无效的备份文件", "error");
              restoreInput.value = "";
            }
          };
          reader.readAsText(file);
        });

        // 检查更新按钮
        document
          .getElementById("check-updates")
          .addEventListener("click", function () {
            showNotification("您已经在使用最新版本 (1.0.0)", "success");
          });
      });
    </script>
  </body>
</html>
