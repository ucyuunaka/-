<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>è¯¾è¯„é€Ÿè®° - è¯¾å ‚åŠ©æ‰‹</title>
    <link rel="stylesheet" href="css/styles.css" />
    <link rel="stylesheet" href="css/sidebar.css" />
    <!-- æ·»åŠ é¡µè„šæ ·å¼ -->
    <link rel="stylesheet" href="css/footer.css" />
    <!-- æ·»åŠ æ»šåŠ¨åŠ¨ç”»æ ·å¼ -->
    <link rel="stylesheet" href="css/scrollAnimation.css" />
    <!-- æ·»åŠ ä¸»é¢˜æ ·å¼ -->
    <link rel="stylesheet" href="css/themes/themes.css" />
    <!-- ä½¿ç”¨å›¾æ ‡åº“ -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <!-- æ·»åŠ  Remix Icon åº“ï¼Œç”¨äºä¾§è¾¹æ å›¾æ ‡ -->
    <link
      href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css"
      rel="stylesheet"
    />
    <!-- æ·»åŠ  emoji picker -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/emoji-picker-element@1.18.3/css/emoji-picker-element.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/emoji-picker-element@1.18.3/index.js"></script>
    <!-- æ·»åŠ é¡µé¢ç‰¹å®šæ ·å¼ -->
    <link rel="stylesheet" href="css/pages/lesson.css" />
  </head>
  <body>
    <!-- ä¾§è¾¹æ å¯¼èˆª - åªä¿ç•™å®¹å™¨å…ƒç´  -->
    <aside class="sidebar"></aside>

    <!-- ç§»åŠ¨ç«¯èœå•åˆ‡æ¢æŒ‰é’® -->
    <div class="sidebar-toggle">
      <i class="ri-menu-line"></i>
    </div>

    <!-- ç§»åŠ¨ç«¯é®ç½©å±‚ -->
    <div class="sidebar-overlay"></div>

    <!-- ä¸»è¦å†…å®¹ -->
    <main class="sidebar-active">
      <!-- è¯¾è¯„é€Ÿè®°æ ‡é¢˜åŒºåŸŸ -->
      <section class="lesson-header">
        <div class="container">
          <h1 class="lesson-title animate-on-scroll fade-up">è¯¾è¯„é€Ÿè®°</h1>
          <p class="lesson-subtitle animate-on-scroll fade-up delay-100">
            ç”¨ç®€çŸ­çš„è¯„ä»·å’Œè¡¨æƒ…è®°å½•ä½ å¯¹è¯¾ç¨‹çš„æ„Ÿå—
          </p>
        </div>
      </section>

      <div class="container">
        <!-- è¿‡æ»¤å™¨ -->
        <section class="lesson-section">
          <div class="filter-container animate-on-scroll fade-up">
            <button class="filter-btn active" data-filter="all">
              å…¨éƒ¨è¯¾ç¨‹
            </button>
            <button class="filter-btn" data-filter="math">æ•°å­¦ç±»</button>
            <button class="filter-btn" data-filter="cs">è®¡ç®—æœºç±»</button>
            <button class="filter-btn" data-filter="eng">è‹±è¯­ç±»</button>
            <button class="filter-btn" data-filter="physics">ç‰©ç†ç±»</button>
          </div>

          <!-- è¾“å…¥åŒºåŸŸ -->
          <div class="input-container animate-on-scroll fade-up">
            <div class="input-header">
              <div class="input-title">è®°å½•æ–°è¯„ä»·</div>
            </div>
            <div class="input-content">
              <select class="course-select" id="courseSelect">
                <option value="">é€‰æ‹©è¯¾ç¨‹...</option>
                <option value="é«˜ç­‰æ•°å­¦" data-category="math">é«˜ç­‰æ•°å­¦</option>
                <option value="çº¿æ€§ä»£æ•°" data-category="math">çº¿æ€§ä»£æ•°</option>
                <option value="æ¦‚ç‡ç»Ÿè®¡" data-category="math">æ¦‚ç‡ç»Ÿè®¡</option>
                <option value="ç¨‹åºè®¾è®¡" data-category="cs">ç¨‹åºè®¾è®¡</option>
                <option value="æ•°æ®åº“åŸç†" data-category="cs">
                  æ•°æ®åº“åŸç†
                </option>
                <option value="æ“ä½œç³»ç»Ÿ" data-category="cs">æ“ä½œç³»ç»Ÿ</option>
                <option value="è®¡ç®—æœºç½‘ç»œ" data-category="cs">
                  è®¡ç®—æœºç½‘ç»œ
                </option>
                <option value="è½¯ä»¶å·¥ç¨‹" data-category="cs">è½¯ä»¶å·¥ç¨‹</option>
                <option value="äººå·¥æ™ºèƒ½å¯¼è®º" data-category="cs">
                  äººå·¥æ™ºèƒ½å¯¼è®º
                </option>
                <option value="è®¡ç®—æœºå›¾å½¢å­¦" data-category="cs">
                  è®¡ç®—æœºå›¾å½¢å­¦
                </option>
                <option value="å¤§å­¦è‹±è¯­" data-category="eng">å¤§å­¦è‹±è¯­</option>
                <option value="å¤§å­¦ç‰©ç†" data-category="physics">
                  å¤§å­¦ç‰©ç†
                </option>
              </select>
              <div class="input-action">
                <button class="emoji-btn" id="emojiButton">ğŸ˜Š</button>
                <button class="send-btn" id="sendButton">å‘é€è¯„ä»·</button>
              </div>
            </div>
            <div class="reaction-tag-container" id="selectedReactions"></div>
          </div>
        </section>

        <!-- è¯¾è¯„åˆ—è¡¨ -->
        <section class="lesson-section">
          <h2 class="section-title animate-on-scroll fade-up">å†å²è¯„ä»·</h2>

          <div class="message-container">
            <div class="message-list" id="messageList">
              <!-- ç¤ºä¾‹æ¶ˆæ¯ -->
              <div
                class="message sent"
                data-course="ç¨‹åºè®¾è®¡"
                data-category="cs"
              >
                <div class="message-content">
                  <div class="course-name">ç¨‹åºè®¾è®¡</div>
                  <div class="message-text">ä»Šå¤©çš„è¯¾ç¨‹å†…å®¹çœŸçš„å¾ˆæ£’ï¼</div>
                  <div class="message-reactions">
                    <div class="reaction-bubble" data-emoji="ğŸ‘">
                      <span class="reaction-emoji">ğŸ‘</span>
                      <span class="reaction-count">3</span>
                    </div>
                    <div class="reaction-bubble" data-emoji="â¤ï¸">
                      <span class="reaction-emoji">â¤ï¸</span>
                      <span class="reaction-count">2</span>
                    </div>
                    <div class="reaction-bubble" data-emoji="ğŸ‰">
                      <span class="reaction-emoji">ğŸ‰</span>
                      <span class="reaction-count">1</span>
                    </div>
                  </div>
                  <div class="message-time">2025-04-08 10:30</div>
                </div>
              </div>

              <div
                class="message received"
                data-course="é«˜ç­‰æ•°å­¦"
                data-category="math"
              >
                <div class="message-content">
                  <div class="course-name">é«˜ç­‰æ•°å­¦</div>
                  <div class="message-text">ä»Šå¤©è®²çš„å¾®ç§¯åˆ†æœ‰ç‚¹éš¾ç†è§£ ğŸ˜µ</div>
                  <div class="message-reactions">
                    <div class="reaction-bubble" data-emoji="ğŸ˜¢">
                      <span class="reaction-emoji">ğŸ˜¢</span>
                      <span class="reaction-count">5</span>
                    </div>
                    <div class="reaction-bubble" data-emoji="ğŸ’ª">
                      <span class="reaction-emoji">ğŸ’ª</span>
                      <span class="reaction-count">2</span>
                    </div>
                  </div>
                  <div class="message-time">2025-04-07 14:15</div>
                </div>
              </div>

              <div
                class="message sent"
                data-course="è®¡ç®—æœºç½‘ç»œ"
                data-category="cs"
              >
                <div class="message-content">
                  <div class="course-name">è®¡ç®—æœºç½‘ç»œ</div>
                  <div class="message-text">
                    TCP/IPåè®®è®²è§£å¾ˆæ¸…æ™°ï¼Œç»ˆäºç†è§£äº†ï¼
                  </div>
                  <div class="message-reactions">
                    <div class="reaction-bubble" data-emoji="ğŸš€">
                      <span class="reaction-emoji">ğŸš€</span>
                      <span class="reaction-count">4</span>
                    </div>
                    <div class="reaction-bubble" data-emoji="ğŸ‘">
                      <span class="reaction-emoji">ğŸ‘</span>
                      <span class="reaction-count">7</span>
                    </div>
                  </div>
                  <div class="message-time">2025-04-06 16:45</div>
                </div>
              </div>

              <div
                class="message received"
                data-course="å¤§å­¦è‹±è¯­"
                data-category="eng"
              >
                <div class="message-content">
                  <div class="course-name">å¤§å­¦è‹±è¯­</div>
                  <div class="message-text">ä»Šå¤©çš„å¬åŠ›ç»ƒä¹ å¾ˆæœ‰æŒ‘æˆ˜æ€§</div>
                  <div class="message-reactions">
                    <div class="reaction-bubble" data-emoji="ğŸ§">
                      <span class="reaction-emoji">ğŸ§</span>
                      <span class="reaction-count">3</span>
                    </div>
                    <div class="reaction-bubble" data-emoji="ğŸ¤”">
                      <span class="reaction-emoji">ğŸ¤”</span>
                      <span class="reaction-count">2</span>
                    </div>
                  </div>
                  <div class="message-time">2025-04-05 09:20</div>
                </div>
              </div>

              <div
                class="message sent"
                data-course="æ•°æ®åº“åŸç†"
                data-category="cs"
              >
                <div class="message-content">
                  <div class="course-name">æ•°æ®åº“åŸç†</div>
                  <div class="message-text">SQLä¼˜åŒ–æŠ€å·§éå¸¸å®ç”¨ï¼</div>
                  <div class="message-reactions">
                    <div class="reaction-bubble" data-emoji="ğŸ’¡">
                      <span class="reaction-emoji">ğŸ’¡</span>
                      <span class="reaction-count">6</span>
                    </div>
                  </div>
                  <div class="message-time">2025-04-04 13:50</div>
                </div>
              </div>
            </div>

            <!-- ç©ºçŠ¶æ€ -->
            <div class="lesson-empty" id="emptyState" style="display: none">
              <div class="lesson-empty-icon">
                <i class="ri-chat-off-line"></i>
              </div>
              <div class="lesson-empty-text">è¿˜æ²¡æœ‰åŒ¹é…çš„è¯¾ç¨‹è¯„ä»·</div>
            </div>
          </div>
        </section>
      </div>
    </main>

    <!-- è¡¨æƒ…é€‰æ‹©å™¨ -->
    <div class="emoji-picker-container" id="emojiPickerContainer">
      <emoji-picker id="emojiPicker"></emoji-picker>
    </div>

    <!-- é¡µè„š - ç®€åŒ–ä¸ºåªä¿ç•™å®¹å™¨ -->
    <footer class="footer"></footer>
    <script src="js/main.js"></script>
    <script src="js/sidebar.js"></script>
    <!-- æ·»åŠ é¡µè„šè„šæœ¬ -->
    <script src="js/footer.js"></script>
    <!-- æ·»åŠ æ»šåŠ¨åŠ¨ç”»è„šæœ¬ -->
    <script src="js/scrollAnimation.js"></script>
    <!-- æ·»åŠ ä¸»é¢˜ç®¡ç†è„šæœ¬ -->
    <script src="js/themes.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // åˆå§‹åŒ–æ»šåŠ¨åŠ¨ç”»
        initScrollAnimation(".animate-on-scroll", {
          threshold: 0.1,
          once: true,
        });

        // DOMå…ƒç´ 
        const emojiButton = document.getElementById("emojiButton");
        const emojiPickerContainer = document.getElementById(
          "emojiPickerContainer"
        );
        const emojiPicker = document.getElementById("emojiPicker");
        const selectedReactions = document.getElementById("selectedReactions");
        const courseSelect = document.getElementById("courseSelect");
        const sendButton = document.getElementById("sendButton");
        const messageList = document.getElementById("messageList");
        const filterButtons = document.querySelectorAll(".filter-btn");
        const emptyState = document.getElementById("emptyState");

        // é€‰å®šçš„è¡¨æƒ…åˆ—è¡¨
        let selectedEmojis = [];

        // è¡¨æƒ…é€‰æ‹©å™¨æ˜¾ç¤º/éšè—
        emojiButton.addEventListener("click", function () {
          emojiPickerContainer.classList.toggle("visible");
        });

        // ç‚¹å‡»å…¶ä»–åœ°æ–¹å…³é—­è¡¨æƒ…é€‰æ‹©å™¨
        document.addEventListener("click", function (e) {
          if (
            !emojiButton.contains(e.target) &&
            !emojiPickerContainer.contains(e.target)
          ) {
            emojiPickerContainer.classList.remove("visible");
          }
        });

        // é€‰æ‹©è¡¨æƒ…
        emojiPicker.addEventListener("emoji-click", (event) => {
          const emoji = event.detail.unicode;

          // é™åˆ¶æœ€å¤šé€‰æ‹©5ä¸ªè¡¨æƒ…
          if (selectedEmojis.length < 5 && !selectedEmojis.includes(emoji)) {
            selectedEmojis.push(emoji);
            updateSelectedEmojis();
          }

          // è‡ªåŠ¨å…³é—­é€‰æ‹©å™¨
          emojiPickerContainer.classList.remove("visible");
        });

        // æ›´æ–°å·²é€‰è¡¨æƒ…æ˜¾ç¤º
        function updateSelectedEmojis() {
          selectedReactions.innerHTML = "";
          selectedEmojis.forEach((emoji, index) => {
            const tag = document.createElement("div");
            tag.className = "reaction-tag";
            tag.innerHTML = `
              <span class="reaction-tag-emoji">${emoji}</span>
              <span class="reaction-tag-text">ç‚¹å‡»åˆ é™¤</span>
            `;
            tag.addEventListener("click", () => {
              selectedEmojis.splice(index, 1);
              updateSelectedEmojis();
            });
            selectedReactions.appendChild(tag);
          });
        }

        // å‘é€è¯„ä»·
        sendButton.addEventListener("click", function () {
          const course = courseSelect.value;
          if (!course) {
            alert("è¯·é€‰æ‹©ä¸€ä¸ªè¯¾ç¨‹");
            return;
          }

          if (selectedEmojis.length === 0) {
            alert("è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªè¡¨æƒ…è¯„ä»·");
            return;
          }

          // åˆ›å»ºæ–°çš„æ¶ˆæ¯
          addNewMessage(course, selectedEmojis);

          // é‡ç½®è¡¨å•
          courseSelect.value = "";
          selectedEmojis = [];
          updateSelectedEmojis();
        });

        // æ·»åŠ æ–°æ¶ˆæ¯
        function addNewMessage(course, emojis) {
          const now = new Date();
          const timeStr = `${now.getFullYear()}-${String(
            now.getMonth() + 1
          ).padStart(2, "0")}-${String(now.getDate()).padStart(
            2,
            "0"
          )} ${String(now.getHours()).padStart(2, "0")}:${String(
            now.getMinutes()
          ).padStart(2, "0")}`;

          // ä»selecté€‰é¡¹è·å–è¯¾ç¨‹åˆ†ç±»
          const categoryOption = Array.from(courseSelect.options).find(
            (option) => option.value === course
          );
          const category = categoryOption
            ? categoryOption.dataset.category
            : "";

          // åˆ›å»ºæ¶ˆæ¯HTML
          const messageEl = document.createElement("div");
          messageEl.className = "message sent";
          messageEl.dataset.course = course;
          messageEl.dataset.category = category;

          // ç”Ÿæˆååº”æ°”æ³¡HTML
          let reactionsHTML = "";
          emojis.forEach((emoji) => {
            reactionsHTML += `
              <div class="reaction-bubble" data-emoji="${emoji}">
                <span class="reaction-emoji">${emoji}</span>
                <span class="reaction-count">1</span>
              </div>
            `;
          });

          messageEl.innerHTML = `
            <div class="message-content">
              <div class="course-name">${course}</div>
              <div class="message-text">æˆ‘çš„è¯¾ç¨‹è¯„ä»·</div>
              <div class="message-reactions">
                ${reactionsHTML}
              </div>
              <div class="message-time">${timeStr}</div>
            </div>
          `;

          // æ·»åŠ åˆ°åˆ—è¡¨æœ€å‰é¢
          messageList.insertBefore(messageEl, messageList.firstChild);

          // è®¾ç½®åŠ¨ç”»
          setTimeout(() => {
            messageEl.classList.add("animate-on-scroll", "fade-up");
          }, 10);

          // æ›´æ–°è¿‡æ»¤çŠ¶æ€
          updateFilter(
            document.querySelector(".filter-btn.active").dataset.filter
          );
        }

        // è¯¾ç¨‹è¿‡æ»¤åŠŸèƒ½
        filterButtons.forEach((btn) => {
          btn.addEventListener("click", function () {
            // æ›´æ–°æŒ‰é’®æ¿€æ´»çŠ¶æ€
            filterButtons.forEach((b) => b.classList.remove("active"));
            this.classList.add("active");

            // åº”ç”¨è¿‡æ»¤
            updateFilter(this.dataset.filter);
          });
        });

        // æ›´æ–°è¿‡æ»¤æ˜¾ç¤º
        function updateFilter(filter) {
          const messages = document.querySelectorAll(".message");
          let visibleCount = 0;

          messages.forEach((msg) => {
            if (filter === "all" || msg.dataset.category === filter) {
              msg.style.display = "flex";
              visibleCount++;
            } else {
              msg.style.display = "none";
            }
          });

          // æ›´æ–°ç©ºçŠ¶æ€æ˜¾ç¤º
          emptyState.style.display = visibleCount > 0 ? "none" : "block";
        }

        // æ·»åŠ ååº”åŠŸèƒ½
        messageList.addEventListener("click", function (e) {
          const reactionBubble = e.target.closest(".reaction-bubble");
          if (reactionBubble) {
            const countEl = reactionBubble.querySelector(".reaction-count");
            let count = parseInt(countEl.textContent);
            count++;
            countEl.textContent = count;

            // æ·»åŠ ç‚¹å‡»åŠ¨ç”»
            reactionBubble.style.transform = "scale(1.2)";
            setTimeout(() => {
              reactionBubble.style.transform = "";
            }, 200);
          }
        });

        // é•¿æŒ‰æ¶ˆæ¯æ˜¾ç¤ºå¿«é€Ÿååº”é€‰æ‹©å™¨
        let pressTimer;

        messageList.addEventListener("mousedown", function (e) {
          const message = e.target.closest(".message");
          if (message) {
            pressTimer = setTimeout(() => {
              showQuickReactions(message);
            }, 500);
          }
        });

        messageList.addEventListener("mouseup", function () {
          clearTimeout(pressTimer);
        });

        messageList.addEventListener("mouseleave", function () {
          clearTimeout(pressTimer);
        });

        // ç§»åŠ¨ç«¯æ”¯æŒ
        messageList.addEventListener("touchstart", function (e) {
          const message = e.target.closest(".message");
          if (message) {
            pressTimer = setTimeout(() => {
              showQuickReactions(message);
            }, 500);
          }
        });

        messageList.addEventListener("touchend", function () {
          clearTimeout(pressTimer);
        });

        // æ˜¾ç¤ºå¿«é€Ÿååº”é€‰æ‹©å™¨
        function showQuickReactions(message) {
          // ç§»é™¤æ‰€æœ‰ç°æœ‰çš„å¿«é€Ÿååº”é€‰æ‹©å™¨
          document
            .querySelectorAll(".quick-reactions")
            .forEach((el) => el.remove());

          // åˆ›å»ºæ–°çš„å¿«é€Ÿååº”é€‰æ‹©å™¨
          const quickReactions = document.createElement("div");
          quickReactions.className = "quick-reactions";

          // å¸¸ç”¨è¡¨æƒ…
          const commonEmojis = ["ğŸ‘", "â¤ï¸", "ğŸ˜‚", "ğŸ‰", "ğŸ˜¢", "ğŸ”¥", "ğŸ‘", "ğŸ¤”"];

          commonEmojis.forEach((emoji) => {
            const item = document.createElement("div");
            item.className = "quick-reaction-item";
            item.textContent = emoji;
            item.addEventListener("click", function () {
              // æ£€æŸ¥æ˜¯å¦å·²æœ‰è¯¥è¡¨æƒ…çš„ååº”
              let reactionBubble = Array.from(
                message.querySelectorAll(".reaction-bubble")
              ).find((bubble) => bubble.dataset.emoji === emoji);

              if (reactionBubble) {
                // æ›´æ–°å·²æœ‰ååº”
                const countEl = reactionBubble.querySelector(".reaction-count");
                let count = parseInt(countEl.textContent);
                count++;
                countEl.textContent = count;
              } else {
                // åˆ›å»ºæ–°ååº”
                const reactionsContainer =
                  message.querySelector(".message-reactions");
                reactionBubble = document.createElement("div");
                reactionBubble.className = "reaction-bubble";
                reactionBubble.dataset.emoji = emoji;
                reactionBubble.innerHTML = `
                  <span class="reaction-emoji">${emoji}</span>
                  <span class="reaction-count">1</span>
                `;
                reactionsContainer.appendChild(reactionBubble);
              }

              // ç§»é™¤é€‰æ‹©å™¨
              quickReactions.remove();
            });

            quickReactions.appendChild(item);
          });

          // æ·»åŠ åˆ°æ¶ˆæ¯å…ƒç´ 
          message.appendChild(quickReactions);

          // æ˜¾ç¤ºé€‰æ‹©å™¨
          setTimeout(() => {
            quickReactions.classList.add("visible");
          }, 10);

          // ç‚¹å‡»å…¶ä»–åœ°æ–¹å…³é—­é€‰æ‹©å™¨
          function closeQuickReactions(e) {
            if (!quickReactions.contains(e.target)) {
              quickReactions.remove();
              document.removeEventListener("click", closeQuickReactions);
            }
          }

          setTimeout(() => {
            document.addEventListener("click", closeQuickReactions);
          }, 10);
        }

        // åˆå§‹è¿‡æ»¤è®¾ç½®ä¸º"å…¨éƒ¨"
        updateFilter("all");
      });
    </script>
  </body>
</html>
